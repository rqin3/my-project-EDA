```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
library(nnet)
```
# <u>**Analysis into Demographic Factors Influencing Access to Healthcare Insurance**</u>
### By Sean Lee, Richard Qin, and Kenneth Lim

## <u>**Dataset Introduction:**</u>
#### The dataset used for this exploratory data analysis (EDA) is the Annual Social and Economic Supplement (ASEC) 2024 of the Current Population Survey (CPS). Administered by the U.S. Census Bureau and the Bureau of Labor Statistics (BLS) annually, the ASEC dataset is a comprehensive source of information about income, poverty, health insurance coverage, and various demographic details of 89,473 households across the United States. It provides detailed insights into socio-economic factors influencing these households and offers a snapshot of the population's financial and social well-being. In addition, the bureau's information covers demographic characteristics from the highest level of education obtained by individuals within the household to the location of each residence. 

### **Scope:**
#### The ASEC 2024 dataset contains household-level information covering variables related to health insurance coverage, income levels, household composition, and geographic metrics such as metropolitan status. Given its national scope and large sample size, the dataset provides valuable insights into socio-economic patterns across different household types. With particular attention to urban-rural disparities, the dataset allows us to uncover trends that could influence public policy and resource allocation. 

### **Ethical Considerations:**
#### Although the dataset is publicly available and anonymized to protect the privacy of respondents, researchers must approach analysis responsibly. Misrepresenting results, overlooking potential biases, or using the data to reinforce stereotypes about rural or urban communities should be avoided. Additionally, it's essential to consider factors such as underreporting of income or access disparities due to systemic inequalities. It is the responsibility of the researchers to recognize and account for social and economic factors that could influence both the dataset and the interpretation of its results.

### **Purpose of the Analysis:**
#### Our group’s interest lies in the healthcare system, more specifically the different factors that influence a population’s ability to access affordable healthcare. Thus, in order to understand the different barriers that individuals face when trying to obtain quality care, it is important to take demographic characteristics into account. Moreover, given that these dynamics continuously change, our group aims to understand how the most recent census data reflects how accessible healthcare is through the mode of health insurance. As health insurance typically dictates an individual’s ability to obtain care from many medical practices and clinics, it’s important to analyze who has health insurance coverage and the different factors that influence the health insurance coverage itself. Hence, this analysis is centered around understanding the in-depth variables that indicate an individual’s health insurance status.

### **Primary Goal of the Analysis:**
#### The primary goal of this analysis is to investigate disparities in health insurance coverage between urban and rural households. Specifically, the focus will be on:

<div class="indent">
  <ul>
    <li>Identifying the distribution of health insurance coverage (full, partial, or none) across urban and rural settings.</li>
    <li>Exploring how household income, age, and gender influence insurance coverage in different geographic regions.</li>
    <li>Understanding how demographic factors such as household size, employment status, and educational attainment impact coverage.</li>
  </ul>
</div>

#### The dataset is read into the R environment using standard functions from the tidyverse library:
```{r}
data=read.csv("data/asecpub24csv/hhpub24.csv")

```

### **Identifying Variables for Analysis:**

<div class="indent">
  <ul>
    <li>GTMETSTA: Metropolitan status of the household (urban or rural classification).</li>
    <ul class="indent">
      <li>1 = Metropolitan</li>
      <li>2 = Non-metropolitan</li>
      <li>3 = Not identified</li>
    </ul>
      
    <li>HPRIV: Private Insurance coverage in the previous year</li>
    <ul class="indent">
      <li>1 = All members of the household</li>
      <li>2 = Some members of the household</li>
      <li>3 = No members of the household</li>
    </ul>
    
    <li>PRIV: Current Private Insurance Coverage</li>
    <ul class="indent">
      <li>1 = All members of the household</li>
      <li>2 = Some members of the household</li>
      <li>3 = No members of the household</li>
    </ul>
    
    <li>HCOV: Health insurance coverage in the previous year (fully covered, partially covered, not covered).</li>
    <ul class="indent">
      <li>1 = All members of the household</li>
      <li>2 = Some members of the household</li>
      <li>3 = No members of the household</li>
    </ul>
    
    <li>NOW_HCOV: Current Health Insurance Coverage</li>
    <ul class="indent">
      <li>1 = All members of the household</li>
      <li>2 = Some members of the household</li>
      <li>3 = No members of the household</li>
    </ul>
    
    <li>HEFAMINC: Total family income.</li>
    <ul class="indent">
      <li>-1 = Unknown Income</li>
      <li>01 = Less than $5,000</li>
      <li>02 = $5,000 to $7,499</li>
      <li>03 = $7,500 to $9,999</li>
      <li>04 = $10,000 to $12,499</li>
      <li>05 = $12,500 to $14,999</li>
      <li>06 = $15,000 to $19,999</li>
      <li>07 = $20,000 to $24,999</li>
      <li>08 = $25,000 to $29,999</li>
      <li>09 = $30,000 to $34,999</li>
      <li>10 = $35,000 to $39,999</li>
      <li>11 = $40,000 to $49,999</li>
      <li>12 = $50,000 to $59,999</li>
      <li>13 = $60,000 to $74,999</li>
      <li>14 = $75,000 to $99,999</li>
      <li>15 = $100,000 to $149,999</li>
      <li>16 = $150,000 and over</li>
    </ul>
  </ul>
</div>


#### The dataset is filtered to only include relevant variables that are determined to be key indicators of medical insurance coverage for the United States population in 2024. In the command, it first filters the major dataset and then keeps the relevant variables listed above using the select function. Next, all of the rows that do not contain data in any of the selected variables are omitted and removed from the dataset. This allows us to create a more concise dataset that will be used for further analysis of how each factor influences an individual’s health insurance coverage. 

## <u>**Data Cleaning:**</u>

```{r}
#Selecting and renaming column titles
filtered_dta=data %>% 
  select(Metro_Status = GTMETSTA, 
         Previous_Private_Insurance = HPRIV, 
         Current_Private_Insurance = NOW_HPRIV, 
         Family_Income = HEFAMINC, 
         Public_Insurance = HPUB, 
         Current_Health_Insurance = NOW_HCOV, 
         Previous_Health_Insurance=HCOV) %>%
  na.omit() 
```

#### The following data is now used to remove rows where the data is unknown for metro status, medicaid status, and family income. By creating a function (named remove_part) to run this removal method, it removes each of the unknown variables. The function works by first determining which parts to remove by looking at each of the specific columns and seeing what is coded for the unknowns for each. Afterwards, the function will determine if any of the data points are unknown for the selected column and if it’s greater than 0, it will remove the data points defined as unknown from the original filtered dataset. For each of the variables, the unknown is defined differently based on the codebook. The Metro Status defines the unknown as the value 3 and the Family Income variable notes the unknown as -1. Thus, the function can adjust to each of the values to properly eliminate the variable that corresponds with whether or not the variable has an unknown.

```{r}
# Function to remove the unknowns from the dataset
remove_part = function(data, column_name, value){
remove_this_part = which(data[[column_name]]==value)
if(length(remove_this_part) > 0){
data = data[-remove_this_part,]
}
  return(data)
}

# Removing Metro Status that equals 3 (unknown)
filtered_dta=remove_part(filtered_dta, "Metro_Status", 3)
# Removing Family Income that equals -1 (unknown)
filtered_dta=remove_part(filtered_dta, "Family_Income", -1)
```

#### The code shown below initially ensures that all the values within the variable Family_Income are numeric variables before classifying those that make above or equal to $75,000 as a value of 2 and those that make less than $75,000 as equal to a value of 1. After cleaning the Family_Income variable, the code then replaces those within the column Metro_Status with categorical variables rather than numerical variables.

#### Moreover, the value of Metro_Status being equal to 1 is now categorized as “Metropolitan”, while any other value is categorized to be “Non-Metropolitan”. This allows the cleaned data to become more clear, and able to be interpreted without the need of a codebook to differentiate between the numerical values. 

#### Afterwards, the values of Family_Income are reclassified into categorical variables from numerical variables as the representation of the values 1 and 2 are categorical instead of numerical. This is in part due to the significance that the values within the Family_Income variable represent ranges rather than specific values. The following code then recoded the numerical variables into more interpretable categories for the Current_Health_Insurance column. The final result would therefore be the value 3 being changed to no health insurance or "None", the value 2 recoded to represent partial health insurance or "Some", and the value 1 recoded to show full health insurance or "All". 

```{r}
#Separating Family Income into binary variables where everything equal to and below 13 is 1 and everything above 13 is 2. 
filtered_dta$Family_Income=ifelse(as.numeric(filtered_dta$Family_Income)<=13,1,2)

#Creating a new dataset with every column needed as factors
clean_dta=filtered_dta %>%
  mutate(
    Metro_Status=ifelse(Metro_Status==1, 
                        "Metropolitan", 
                        "Non-Metropolitan"),
    Family_Income=as.factor(Family_Income),
    Current_Health_Insurance=factor(Current_Health_Insurance,
                        levels=c(3,2,1),
                        labels=c("None",
                                 "Some", 
                                  "All"))
  )
```
## <u>**Data Visualizations:**</u>

#### This code calculates the number and proportion of households based on three criteria:
<div class="indent">
  <ul>
    <li>Residence in Metropolitan vs. Non-Metropolitan areas.</li>
    <li>Family income above $75,000 vs. $75,000 or below.</li>
    <li>Health insurance coverage categorized as full, partial, or none.</li>
  </ul>
</div>

#### From the results, we see that this dataset has more people living in metropolitan areas, with 82.1% of households in metropolitan areas. We also see 88% of the sample size has insurance for all family members. In contrast, when it comes to family income, we can see that the proportions are much closer, with 53.5% of households having a family income less than $75,000, and 46.5% of households with a family income above this threshold. 
```{r}
#Creating tables and proportion tables for Metro_Status, Current_Health_Insurance

table(clean_dta$Metro_Status)
prop.table(table(clean_dta$Metro_Status))

table(clean_dta$Current_Health_Insurance)
prop.table(table(clean_dta$Current_Health_Insurance))

#Family_Income (1: <=75,000, 2: >75,000)
table(clean_dta$Family_Income)
prop.table(table(clean_dta$Family_Income))
```
#### To interpret these results more easily, we can create pie charts that can visualize the proportions easily. This next chunk of code does so. First of all, since we need to make multiple plots, we can operationalize the process by first creating a function. 

#### The code for the function create_pie_chart incorporates 3 parameters: data, column_name, and title. Initially, the function creates the tables and renames the columns as category and count. Then, the proportions were calculated as percentages by dividing the count by the total count and multiplying by 100. This information is then added to the new column "Label" that combines the category, count, and percentage, which will be displayed on the pie chart. It finally uses ggplot2 to create a pie chart with polar coordinates and labeled with geom_text. 

#### Once the pie chart function is made, it is run with Metro_Status, Current_Health_Insurance, and Family_Income, to visualize the distributions. 
```{r}
#Function to create a pie chart with labels
create_pie_chart=function(data, column_name, title) {
  df=as.data.frame(table(data[[column_name]]))
  colnames(df)=c("Category", "Count")
  
#Compute percentage
  df$Percentage=round(df$Count / sum(df$Count) * 100, 1)
  df$Label = paste0(df$Category, "\n", df$Count, " (", df$Percentage, "%)")

  ggplot(df, aes(x = "", y = Count, fill = as.factor(Category))) +
    geom_bar(stat = "identity", width = 1, color = "white") +
    coord_polar("y", start=0) +
    geom_text(aes(label=Label), position=position_stack(vjust=0.5), size=2) +
    labs(title=title, fill=column_name) +
    theme_void() +
    theme(legend.title=element_blank())
}

#Create pie charts
Metro_Status_Distribution_Pie_Chart=create_pie_chart(clean_dta, "Metro_Status", "Metro Status Distribution")
Current_Health_Insurance_Distribution_Pie_Chart=create_pie_chart(clean_dta, "Current_Health_Insurance", "Current Health Insurance Distribution")
Family_Income_Distribution_Pie_Chart=create_pie_chart(clean_dta, "Family_Income", "Family Income Distribution")
```

```{r, echo=FALSE}
#Display the plots
Metro_Status_Distribution_Pie_Chart
Current_Health_Insurance_Distribution_Pie_Chart
Family_Income_Distribution_Pie_Chart

```

#### This code calculates the proportion of households with Family Income over $75000 in both the Urban and Rural Groups and plots on a stacked barplot. It first uses the filtered data to provide the frequency for each of the following variables, Metro_Status and Family_Income. Afterward, it is grouped by the Metro_Status, so either living in a metropolitan region or non-metropolitan region before calculating the proportion of family income based on the type of region the household resides in.

## <u>**Data Analysis:**</u>

#### The following code runs a multinomial logistic regression model. Essentially, how this regression model functions is that it uses two or more categorical independent variables that do not have a natural order to determine the dependent variable. In this specific analysis model, the categorical dependent variable, or the outcome being predicted, is the Current_Health_Insurance which has three levels: no health insurance, partial health insurance coverage, and full health insurance coverage. There are two independent variables, or the predictors, that are used to predict each household’s health insurance status: Metro_Status and Family_Income. In Metro_Status, as aforementioned, two categories are whether a household lives in a “Metropolitan” region or a “Non-Metropolitan” region. In the following predictor of income, it is categorized into high income (value of 2) and low income (value of 1). 
```{r}
#Running the multinomial model with current health insurance as outcome, metropolitan status as input, controlling for family income
multinom_model=multinom(Current_Health_Insurance ~ Metro_Status + Family_Income, data = clean_dta)
summary_model=summary(multinom_model)
summary_model
```

#### The following code is used to summarize the coefficients for each of the estimated effects of the predictor variables, the standard errors of each coefficient estimate, and the baseline category which is compared to other variables. Afterward, this model computes the Z-values for each of the coefficients within the formula, and based on the following Z-values, it will provide the p-values of each to determine whether or not each predictor variable is statistically significant.

```{r}
#Calculating for p-values of the model
z_values=summary_model$coefficients / summary_model$standard.errors
p_values=2 * (1 - pnorm(abs(z_values)))
p_values

```
#### The results of the multinomial regression show that health insurance status is significantly affected by family income. The model shows that higher income levels are strongly associated with a greater likelihood of having either partial or full health insurance coverage in the family. The effect of living in a non-metropolitan area is relatively small (log(OR)=0.11), but it appears to have a modest impact on the likelihood of having full coverage, as suggested by the statistically significant p value of 0.046. However, living in a metropolitan area does not show a strong relationship with having partial insurance (log(OR)=0.02, p=0.745). Thus, policy interventions aimed at improving health insurance coverage should focus on addressing income disparities rather than metropolitan status. In other words, income plays a much more substantial role than geographic location in determining insurance access.


IGNORE THIS PART

## <u>**Next Steps:**</u>

#### There are still many insights that can be taken from this dataset that could be pursued further. There are a whole host of factors that could act as confounders in this relationship. This sample takes into account people from every state. There are many policy and legislative differences between states that could skew the results. For example, ___. 

#### Further, this exploratory analysis has only looked at a fraction of the many columns available in the Annual Social and Economic Supplement Dataset. There are many questions that could be asked



